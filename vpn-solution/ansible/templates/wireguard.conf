# Fail2Ban Filter for WireGuard
# Detects failed WireGuard connection attempts

[Definition]

# Detect invalid handshake initiations and other WireGuard-related failures
failregex = ^.*wireguard.*: Invalid handshake initiation from <HOST>.*$
            ^.*wireguard.*: Packet has unallowed src IP from <HOST>.*$
            ^.*wireguard.*: Receiving handshake initiation from unknown peer <HOST>.*$

# Lines to ignore (successful connections, normal operations)
ignoreregex = ^.*wireguard.*: Handshake completed.*$
              ^.*wireguard.*: Receiving keepalive packet from peer.*$
              ^.*wireguard.*: Sending handshake response to peer.*$

# Journal match for systemd backend
journalmatch = _SYSTEMD_UNIT=wg-quick@wg0.service + _COMM=wg

[Init]
# Maximum lines to examine
maxlines = 10

# Date format
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S